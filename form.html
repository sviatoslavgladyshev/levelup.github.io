<!DOCTYPE html>
<html>
<head>
    <title>Job Posting Form</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
</head>
<body>
    <form id="jobForm">
        <input type="text" id="title" placeholder="Job Title" required>
        <input type="text" id="description" placeholder="Job Description" required>
        <input type="text" id="salary" placeholder="Salary" required>
        <input type="number" id="workHours" name="workHours" min="0" placeholder="Enter work hours" required>
        <select id="industry" required>
            <option value="">Select Industry</option>
            <option value="accounting">Accounting</option>
            <option value="advertising">Advertising</option>
            <!-- Other industry options -->
            <option value="other">Other</option>
        </select>
        <input type="text" id="otherindustry" placeholder="Other Industry" style="display: none;">
        <input type="submit" value="Post Job">
        <button id="backToProfile">Back to Profile</button>
    </form>
    <div id="userIdDisplay"></div>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDWXpvIim5vIzo-mMJvojHF5sJ04WgBvSA",
          authDomain: "levelup-65b5b.firebaseapp.com",
          projectId: "levelup-65b5b",
          storageBucket: "levelup-65b5b.appspot.com",
          messagingSenderId: "13469845736",
          appId: "1:13469845736:web:aa4b300ead478eac30215d",
          measurementId: "G-B7HVG7T7VZ"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        document.getElementById('industry').addEventListener('change', function() {
            if (this.value === 'other') {
                document.getElementById('otherindustry').style.display = 'inline-block';
            } else {
                document.getElementById('otherindustry').style.display = 'none';
            }
        });
        // Show or hide the "otherindustry" input based on the selected industry
        document.getElementById('industry').addEventListener('change', function() {
            if (this.value === 'other') {
                document.getElementById('otherindustry').style.display = 'inline-block';
            } else {
                document.getElementById('otherindustry').style.display = 'none';
            }
        });

        // Add event listener for the button
        document.getElementById('backToProfile').addEventListener('click', function() {
            // Redirect to the profile page
            window.location.href = 'profile.html';
        });

        // Function to handle form submission
        document.getElementById('jobForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission behavior

            // Get form values
            const title = document.getElementById('title').value.toLowerCase().split(' ').join('_');
            const description = document.getElementById('description').value;
            const salary = document.getElementById('salary').value;
            const workHours = document.getElementById('workHours').value;
            const industry = document.getElementById('industry').value.toLowerCase();
            const otherIndustry = document.getElementById('otherindustry').value.toLowerCase();

            // Check for empty fields
            if (!title || !description || !salary || !workHours || !industry) {
                alert("Please fill in all required fields.");
                return;
            }

            // Get userId from local storage
            let userId = localStorage.getItem('userId');
            // Check if userId exists
            if (userId) {
                let jobRef;

                if (industry === 'other') {
                    jobRef = db.collection('job_postings').doc(otherIndustry);
                } else {
                    jobRef = db.collection('job_postings').doc(industry);
                }

                // Set the document data
                jobRef.set({
                    userId: userId,
                    job_title: title,
                    description: description,
                    salary: salary,
                    workHours: workHours,
                    industry: industry === 'other' ? otherIndustry : industry
                })
                .then(() => {
                    console.log("Document successfully written!");
                    // Clear the form
                    document.getElementById('jobForm').reset();
                })
                .catch((error) => {
                    console.error("Error writing document: ", error);
                });

                // Set the document data for job posted by employer
                let employerRef = db.collection('employers').doc(userId);
                let jobPostedRef = employerRef.collection('job_posted').doc(title);

                jobPostedRef.set({
                    title: title,
                    description: description,
                    salary: salary,
                    workHours: workHours,
                    industry: industry === 'other' ? otherIndustry : industry
                })
                .then(() => {
                    console.log("Job posted document successfully written!");
                })
                .catch((error) => {
                    console.error("Error writing job posted document: ", error);
                });
            }
        });
    </script>
</body>
</html>
