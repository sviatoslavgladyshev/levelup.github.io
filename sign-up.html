<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Sign Up</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap&subset=latin-ext" rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/fontawesome-all.css" rel="stylesheet">
    <link href="css/swiper.css" rel="stylesheet">
    <link href="css/magnific-popup.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link rel="icon" href="images/white_logo.png">
</head>
<body data-spy="scroll" data-target=".fixed-top">
    <div class="spinner-wrapper">
        <div class="spinner">
            <div class="bounce1"></div> 
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top", style="background-color: rgb(135, 25, 206); padding: 1rem 0.75rem 1rem 0.75rem">
            <div class="container">
    
                <!-- Text Logo - Use this if you don't have a graphic logo -->
                <!-- <a class="navbar-brand logo-text page-scroll" href="index.html">LevelUp</a> -->
    
                <!-- Image Logo -->
                <a class="navbar-brand logo-image no-underline" href="index.html"><span class="brand-text">LvlUp!</span> <img src="images/logo_transparent.png" alt="alternative"></a>
                
                <!-- Mobile Menu Toggle Button -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-awesome fas fa-bars"></span>
                    <span class="navbar-toggler-awesome fas fa-times"></span>
                </button>
                <!-- end of mobile menu toggle button -->
    
                <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link page-scroll" href="index.html#header">HOME <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle page-scroll" href="#video" id="navbarDropdown" role="button" aria-haspopup="true" aria-expanded="false">ABOUT</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown", style="border: 1.5px solid rgb(50, 100, 200)">
                                <a class="dropdown-item" href="article-details.html"><span class="item-text">ABOUT US</span></a>
                                <div class="dropdown-items-divide-hr"></div>
                                <a class="dropdown-item" href="terms-conditions.html"><span class="item-text">NEWSROOM</span></a>
                                <div class="dropdown-items-divide-hr"></div>
                                <a class="dropdown-item" href="privacy-policy.html"><span class="item-text">CONTACT US</span></a>
                                <div class="dropdown-items-divide-hr"></div>
                                <a class="dropdown-item" href="privacy-policy.html"><span class="item-text">CAREER OPPORTUNITIES</span></a>
                            </div>
                        </li>
                    </ul>
                    <span class="nav-item">
                        <li class="nav-item dropdown">
                            <a class="btn-outline-sm", id="navbarDropdown", role="button", aria-haspopup="true" aria-expanded="false" href="log-in.html">LOG IN FOR AN EMPLOYER</a>
                            <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown", style="background-color: rgb(135, 25, 206); border: 1.5px solid rgb(50)">
                                <a class="dropdown-item" href="#" onclick="signOut()"><span class="item-text">SIGN OUT</span></a>
                            </div> -->
                        </li>
    
                    </span>
                </div>
            </div> <!-- end of container -->
        </nav> <!-- end of navbar -->
        <!-- end of navigation -->
              <!-- Breadcrumbs -->
      <div class="ex-basic-1">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumbs">
                        <!-- <a href="index.html">Home</a><i class="fa fa-angle-double-right"></i><span>Terms & Conditions</span> -->
                    </div> <!-- end of breadcrumbs -->
                </div> <!-- end of col -->
            </div> <!-- end of row -->
        </div> <!-- end of container -->
    </div> <!-- end of ex-basic-1
    end of breadcrumbs -->
    <header id="header" class="ex-2-header signup" style="background-color: brown;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
    <h1>Start Your LevelUp</h1>
    <p>Already signed up? Then just <a class="white" href="log-in.html">Log In</a></p> 
    <div class="form-container", style="padding: 2.25rem 1.75rem 0.01rem 1.75rem; margin-bottom: 10rem;">
    <form id="sign-up-form">
        <div class="form-group">
            <input type="text" id="company_name" class="form-control-input" required>
            <label for="company_name" class="label-control" >Company Name:</label>
            <!-- <div class="help-block with-errors"></div> -->
            </div>
        <div class="form-group">
        <input type="email" id="business_email" class="form-control-input" required>
        <label for="email" class="label-control" >Business Email:</label>
        <div class="help-block with-errors" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.1);"></div>
        </div>
        <div class="form-group">
            <input type="password" id="password" class="form-control-input" required minlength="8">
            <label for="password" class="label-control">Password:</label>
            <div class="help-block with-errors"></div>
            </div>
        <div class="form-group checkbox">
        <input type="checkbox" id="agree" name="agree" required>
        <label for="agree">I agree with LevelUp's <a href="privacy-policy.html">Privacy Policy</a> and <a href="terms-conditions.html">Terms Conditions</a></label>
        </div>
        <input type="hidden" id="timestamp">
        <div class="form-group">
        <button type="submit" id="submitBtn" class="form-control-submit-button">Sign Up</button>
    </div>
    </form>
                    </div>
                </div> <!-- end of col -->
            </div> <!-- end of row -->
        </div> <!-- end of container -->
    </header> <!-- end of ex-header -->
    <script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDWXpvIim5vIzo-mMJvojHF5sJ04WgBvSA",
            authDomain: "levelup-65b5b.firebaseapp.com",
            projectId: "levelup-65b5b",
            storageBucket: "levelup-65b5b.appspot.com",
            messagingSenderId: "13469845736",
            appId: "1:13469845736:web:aa4b300ead478eac30215d"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    // Helper Function to convert a string to snake case
    function toSnakeCase(str) {
        return str.toLowerCase().replace(/\s+/g, '_');
    }

    document.addEventListener("DOMContentLoaded", function() {
        const signUpForm = document.getElementById('sign-up-form');
        const emailInput = document.getElementById('business_email'); // Corrected ID for business email
        const errorBlock = document.querySelector(".help-block.with-errors");
        const submitBtn = document.getElementById('submitBtn'); // Define submit button

        const personalEmailDomains = [
            "gmail.com", "yahoo.com", "outlook.com", "aol.com",
            "protonmail.com", "zoho.com", "yandex.com", "yandex.ru", "mail.com",
            "gmx.com", "icloud.com", "fastmail.com", "tutanota.com",
            "mail.ru", "hushmail.com", "airmail.net", "lycos.com",
            "netcourrier.com", "zimbra.com", "rediffmail.com", "mailinator.com",
            "yandex.net", "yastatic.net", "yandex.com.tr", "yandex.kz", "yandex.ua"
        ];

        signUpForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission

            const email = emailInput.value;
            const domain = email.split('@')[1];
            if (personalEmailDomains.includes(domain)) {
                errorBlock.textContent = "Please enter a business email address.";
                return;
            } else {
                errorBlock.textContent = "";
            }

            // Indicate loading
            submitBtn.innerHTML = 'Signing Up...';
            submitBtn.disabled = true;

            // Collect form data
            const companyName = document.getElementById('company_name').value;
            const password = document.getElementById('password').value;
            const agree = document.getElementById('agree').checked;
            const timestamp = new Date().toISOString(); // Example of how you might set a timestamp

            // Create user with email and password
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((cred) => {
                    // Send email verification
                    return cred.user.sendEmailVerification().then(() => {
                        // Save additional user data to Firestore
                        const sanitizedCompanyName = companyName.replace(/[^a-zA-Z0-9-_]/g, '_');
                        return db.collection('employers').doc(sanitizedCompanyName).set({
                            company_name: companyName,
                            business_email: email,
                            agree: agree,
                            timestamp: timestamp
                        });
                    })
                    .then(() => {
                        window.location.assign('get_started.html'); // Redirect after successful account creation and data saving
                    });
                })
                .catch((error) => {
                    console.error("Error creating user:", error);
                    alert("Error: Unable to create user. Please try again later.");
                })
                .finally(() => {
                    // Revert button to original state regardless of success or failure
                    submitBtn.innerHTML = 'Sign Up';
                    submitBtn.disabled = false;
                });
        });

        firebase.auth().onAuthStateChanged((user) => {
            const loginLink = document.getElementById("navbarDropdown-profile");
            if (user) {
                loginLink.textContent = "MY PROFILE";
                loginLink.href = "/profile.html";
            } else {
                loginLink.textContent = "LOG IN FOR AN EMPLOYER";
                loginLink.href = "/log-in.html";
            }
        });

        const handleSelectChange = (event) => {
            if (event.target.value) {
                event.target.classList.add('notEmpty');
            } else {
                event.target.classList.remove('notEmpty');
            }
        };

        document.getElementById('state').addEventListener('change', handleSelectChange);
        document.getElementById('industry').addEventListener('change', handleSelectChange);

        document.getElementById('sign-out-button').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = "/index.html";
            }).catch((error) => {
                console.error("Sign out error", error);
            });
        });
    });
</script>
    <!-- Scripts -->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <script src="js/swiper.min.js"></script>
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="js/validator.min.js"></script>
    <script src="js/scripts.js"></script>   
</body>
</html>
